# このリポジトリについて
このリポジトリは、宇宙マイクロ波背景放射（CMB）の温度揺らぎから、円同士の相関を取るための解析コードになります。このソースコードを使用することで、宇宙空間が3次元トーラス構造を持つかどうか、探ることができます。※宇宙がホライズンよりも非常にコンパクトであること（小さいこと）を想定。

# 詳細
- プログラム言語：Fortran90
- 使用ツール：OpenMP、Healpix
- 利用環境、開発環境：CentOS、Linux、Cygwin(windows10)

# 参考サイト
- https://www.cosmos.esa.int/web/planck
- https://qiita.com/github-nakasho/items/6d2e06a3caca1f00f58a
- https://mphitchman.com/geometry/section8-3.html

# コンパイル例
- 以下のコマンドを実行することで、相関を取るための実行ファイルが作成されます。

```
gfortran -fopenmp -I/usr/local/lib/Healpix_3.20/include cmb_cits_3.f90 cmb_cits_2.f90 cmb_cits_1.f90 cmb_cits_main.f90 -o ./correlation.out -L/usr/local/lib/Healpix_3.20/lib -L/usr/local/cfitsio -lhealpix -lgif -lcfitsio
```
- 以下のコマンドを実行することで、揺らぎの解像度（ピクセルの大きさや数）を変更するための実行ファイルが作成されます。
```
gfortran -fopenmp -I/usr/local/lib/Healpix_3.20/include cmb_output.f90 -o ./map.out -L/usr/local/lib/Healpix_3.20/lib -L/usr/local/cfitsio -lhealpix -lgif -lcfitsio
```
- ./map.outの実行ファイルを実行することで、データの解像度を変更することができます。
- 実行環境が異なる場合、同じプロンプト内容で正しく開始できる保証はないため、環境に応じたコマンドに修正する必要があります。

# cmb_cits_main.f90
プログラムを実行するメインプログラム。デフォルトでは以下の通りの値が入力されています。
- オイラー回転させる回数：rotation=3000000回<br>
※解析が終了するまでに時間を要するため、開発やテストでは試行回数を減らしてください
- OpemMPで利用するスレッドの数：thread=30スレッド<br>
  ※当時、高価なコンピュータを利用しており、スレッドが最大40スレッドあったため、30と指定しています。通常は1,2など少ない数を入力してください。
- 取得するヒストグラムデータのパラメータ：hi_p=100
- このソースを実行した場合、cmb_cits_1.f90が実行されます。

# cmb_cits_1.f90
向き合う同士の温度揺らぎの相関を取るためのモジュール関数。
- これを実行すると、cmb_cits_2.f90、cmb_cits_3.f90も同時に実行されます。
- より詳細な情報は、お問い合わせください。

# cmb_cits_2.f90
極座標(θ,φ)に対するランダムな値を取得するためのモジュール関数。
- 実行することで、オイラー回転させるためのランダムな値(θm,φm)を得ることができます。
- なぜこのようなランダム関数を作ったかについて。<br>
球面上でランダムな位置(θ,φ)を得る必要があり、通常のランダム関数を用いただけでは、試行回数を増やすと、密になりやすい位置と疎になりやすい位置（出力結果）が出てくるためこのモジュール関数を作りました。統計的に解析する場合は、位置（出力結果）にムラが出ないようにする必要があったため、このランダム関数を作った。

# cmb_cits_3.f90
極座標(θ,φ)の位置を、(θm,φm)分だけオイラー回転させるためのモジュール関数。<br>
- 極座標(θ,φ)の位置から、(θm,φm)分だけオイラー回転させることができ、オイラー回転後の極座標(θ1,φ1)が得られる。
- 入力値：極座標(θ,φ)、オイラー回転角度(θm,φm)
- 出力値：極座標(θ1,φ1)

# cmb_output.f90
CMBの揺らぎの解像度（ピクセルの大きさや数）を変更するためのプログラム。<br>
- mapfitsの部分で、対象とするデータの解像度を変えることができます。
- 解像度を変更したデータをもとに、cmb_cits_main.f90で解析をかけることで、解像度に応じた結果を得られます。
- より詳細な情報は、お問い合わせください。

# OpenACCについて
OpenACCを適応したソースコードも持っていますが、都合上、GitHubへ公開・保管していません。
